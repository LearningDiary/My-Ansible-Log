# 06 Ansible Playbook拓展

## 6.1. Handlers

- 使用```notify```来触发Handlers，来实现相应的功能。

- 实现一个任务同时调用多个Handlers

  ```yaml
  - name: Rebuild application configuration.
      command: /opt/app/rebuild.sh
  notify:
      - restart apache
      - restart memcached
  ```

- 若要实现Handlers调用Handlers，则直接在Handlers中使用notify选项即可。

  ```yaml
  handlers:
      - name: restart apache
        service: name=apache2 state=restarted
        notify: restart memcached
      - name: restart memcached
        service: name=memcached state=restarted
  ```

- 在使用Handlers的过程中，有以下几点需要格外注意。

  - Handlers只有在其所在的任务被执行时，才会被运行；如果一个任务中定义了notify调用Handlers，但是由于条件判断等原因，该任务未被执行，那么Handlers同样不会被执行。
  - Handlers只会在Play的末尾运行一次；如果想在一个Playbook的中间运行Handlers，则需要使用meta模块来实现，例如：- meta: flush_handlers。
  - 如果一个Play在运行到调用Handlers的语句之前失败了，那么这个Handlers将不会被执行。我们可以使用mega模块的--force-handlers选项来强制执行Handlers，即使是Handlers所在的Play中途运行失败也能执行。

## 6.2. 环境变量



## 6.3.

## 6.4.

## 6.5. 



